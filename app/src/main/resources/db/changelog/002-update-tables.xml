<?xml version="1.1" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

    <changeSet id="28072022-update_users-add_full_name-v2" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="users" columnName="full_name"/>
            </not>
        </preConditions>
        <addColumn tableName="users">
            <column name="full_name" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="01082002-update_receipts-add_date_of_payment-v1" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="receipts" columnName="receipt_status"/>
            </not>
        </preConditions>
        <addColumn tableName="receipts">
            <column name="date_of_payment" type="timestamp with timezone">
                <constraints nullable="false" uniqueConstraintName="receipts-date_of_payment"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="01082002-update_receipts-add_receipt_status-v2" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="receipts" columnName="receipt_status"/>
            </not>
        </preConditions>
        <addColumn tableName="receipts">
            <column name="RECEIPT_STATUS" type="varchar(255)">
                <constraints nullable="false" uniqueConstraintName="receipts-receipts-receipt_status"/>
            </column>
        </addColumn>
        <addDefaultValue tableName="receipts" columnName="receipt_status" defaultValue="PENDING"/>
    </changeSet>

    <changeSet id="01082002-update_receipts-add_favor_name-v1" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="receipts" columnName="favor_name"/>
            </not>
        </preConditions>
        <addColumn tableName="receipts">
            <column name="favor_name" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="01082002-update_groups_students-update_student_user_id-v4" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="GROUPS_STUDENTS" columnName="STUDENTS_USER_ID"/>
        </preConditions>
        <modifyDataType tableName="GROUPS_STUDENTS" columnName="STUDENTS_USER_ID" newDataType="BIGINT"/>
    </changeSet>

    <changeSet id="01082002-update_receipts-update_student_id-v2" author="shubelko">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="RECEIPTS" columnName="STUDENT_ID"/>
        </preConditions>
        <modifyDataType tableName="RECEIPTS" columnName="STUDENT_ID" newDataType="BIGINT"/>
    </changeSet>

</databaseChangeLog>